<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<h:head>
   <meta charset="UTF-8"/>
   <title>Your Cart</title>
   <h:outputStylesheet>
      body {
         background-color: #f5f5f7;
         font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", sans-serif;
         color: #1f2937;
      }

      .cart-container {
         max-width: 1152px;
         margin: 6rem auto 0;
         padding: 0 1.5rem;
      }

      .cart-title {
         font-size: 1.875rem;
         font-weight: 600;
         margin-bottom: 2rem;
      }

      .empty-cart {
         color: white;
         text-align: center;
         color: #6b7280;
         margin-top: 5rem;
      }

      .browse-btn {
         margin-top: 1.5rem;
      }

      .product-image {
         width: 64px;
         height: 64px;
         border-radius: 0.75rem;
         background-color: #e5e7eb;
         display: flex;
         align-items: center;
         justify-content: center;
      }

      .product-image img {
         width: 100%;
         height: 100%;
         object-fit: cover;
         border-radius: 0.75rem;
      }

      .quantity-controls {
         display: flex;
         align-items: center;
         gap: 0.5rem;
      }

      .cart-total-section {
         margin-top: 2rem;
         display: flex;
         justify-content: space-between;
         align-items: center;
         flex-wrap: wrap;
         gap: 1rem;
      }

      .cart-total {
         font-size: 1.5rem;
         font-weight: 600;
      }

      .ui-datatable {
         background: white;
         border-radius: 1rem;
         box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
      }

      .ui-datatable thead th {
         background: white;
         color: #374151;
         font-weight: 500;
         border-bottom: 1px solid #e5e7eb;
         padding: 1rem 1.5rem;
      }

      .ui-datatable tbody td {
         padding: 1rem 1.5rem;
         border-bottom: 1px solid #f3f4f6;
      }

      .ui-button.qty-btn {
         width: 32px;
         height: 32px;
         border-radius: 50%;
         background-color: #e5e7eb;
         border: none;
         color: #000;
      }

      .ui-button.qty-btn:hover {
         background-color: #d1d5db;
      }

      .ui-button.remove-btn {
         background-color: #dc2626;
         border: none;
         border-radius: 0.5rem;
         padding: 0.25rem 0.75rem;
      }

      .ui-button.remove-btn:hover {
         background-color: #ef4444;
      }

      .ui-button.checkout-btn {
         background-color: #000;
         border: none;
         border-radius: 0.75rem;
         padding: 0.75rem 1.5rem;
         font-size: 1rem;
      }

      .ui-button.checkout-btn:hover {
         background-color: #1f2937;
      }

      .ui-button.browse-products-btn {
         background-color: #000;
         border: none;
         border-radius: 0.75rem;
         padding: 0.75rem 1.5rem;
         font-size: 1rem;
         color: white;
      }

      .ui-button.browse-products-btn:hover {
         background-color: #1f2937;
      }

      .qty-input {
         width: 48px;
         text-align: center;
         border: 1px solid #d1d5db;
         border-radius: 0.5rem;
         padding: 0.25rem;
      }
   </h:outputStylesheet>
</h:head>

<ui:include src="../navbar.xhtml"/>

<h:body styleClass="apple-font text-gray-800" style="margin-top: 70px">

   <!-- Success Message -->
   <p:growl id="messages" showDetail="true" life="3000"/>

   <div class="cart-container">
      <h1 class="cart-title">Your Cart</h1>

      <h:form id="cartForm">
         <!-- Empty Cart Message -->
         <h:panelGroup rendered="#{empty cartBean.cart.cartItems}">
            <p class="empty-cart">Your cart is empty.</p>
            <div style="text-align: center;" class="browse-btn">
               <p:button value="Browse Products"
                         outcome="/product/list.xhtml"
                         styleClass="browse-products-btn"/>
            </div>
         </h:panelGroup>

         <!-- Cart Items Table -->
         <h:panelGroup rendered="#{not empty cartBean.cart.cartItems}">
            <p:dataTable id="cartTable"
                         value="#{cartBean.cart.cartItems}"
                         var="item"
                         styleClass="cart-datatable">

               <!-- Product Column -->
               <p:column headerText="Product">
                  <div style="display: flex; align-items: center; gap: 1rem;">
                     <div class="product-image">
                        <h:panelGroup rendered="#{not empty item.product.image}">
                           <p:graphicImage value="#{cartBean.getImagePath(item.product.image)}"
                                           alt="#{item.product.label}"/>
                        </h:panelGroup>
                        <h:panelGroup rendered="#{empty item.product.image}">
                           <span style="color: #9ca3af; font-size: 0.875rem;">No Image</span>
                        </h:panelGroup>
                     </div>
                     <span style="font-weight: 500;">#{item.product.label}</span>
                  </div>
               </p:column>

               <!-- Price Column -->
               <p:column headerText="Price">
                  <h:outputText value="$#{item.product.price}">
                     <f:convertNumber pattern="#0.00"/>
                  </h:outputText>
               </p:column>

               <!-- Quantity Column -->
               <p:column headerText="Quantity">
                  <div class="quantity-controls">
                     <p:commandButton value="âˆ’"
                                      styleClass="qty-btn"
                                      action="#{cartBean.decreaseQuantity(item.product.id)}"
                                      update="cartTable cartTotal messages"
                                      process="@this"
                                      disabled="#{item.quantity le 1}"/>

                     <p:inputText value="#{item.quantity}"
                                  readonly="true"
                                  styleClass="qty-input"/>

                     <p:commandButton value="+"
                                      styleClass="qty-btn"
                                      action="#{cartBean.increaseQuantity(item.product.id)}"
                                      update="cartTable cartTotal messages"
                                      process="@this"/>
                  </div>
               </p:column>

               <!-- Subtotal Column -->
               <p:column headerText="Subtotal">
                  <h:outputText value="$#{item.quantity * item.product.price}">
                     <f:convertNumber pattern="#0.00"/>
                  </h:outputText>
               </p:column>

               <!-- Remove Column -->
               <p:column headerText="Remove">
                  <p:commandButton value="Remove"
                                   styleClass="remove-btn"
                                   style="color: white;"
                                   action="#{cartBean.removeItem(item.product.id)}"
                                   update="cartForm messages"
                                   process="@this">
                     <p:confirm header="Confirmation"
                                message="Are you sure you want to remove this item?"
                                icon="pi pi-exclamation-triangle"/>
                  </p:commandButton>
               </p:column>
            </p:dataTable>

            <!-- Total and Checkout -->
            <div class="cart-total-section">
               <div class="cart-total">
                  Total: <h:outputText id="cartTotal" value="$#{cartBean.cartTotal}">
                  <f:convertNumber pattern="#0.00"/>
               </h:outputText>
               </div>

               <p:commandButton value="Checkout"
                                style="color: white;"
                                styleClass="checkout-btn"
                                action="#{orderBean.saveOrder()}"
                                ajax="false"/>
            </div>
         </h:panelGroup>

         <!-- Confirmation Dialog -->
         <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
            <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes"/>
            <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no"/>
         </p:confirmDialog>
      </h:form>
   </div>
</h:body>
</html>